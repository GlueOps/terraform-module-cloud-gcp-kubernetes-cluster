# terraform-module-cloud-gcp-kubernetes-cluster

This Terraform module deploys everything you need in GCP to get a kubernetes cluster up and running. This repo should be used in the context of deploying with an [admiral](https://github.com/glueops/admiral)

## Prerequisites

### Project Setup

1. Create a **new** GCP Project with the following APIs enabled:

```
cloudresourcemanager.googleapis.com
compute.googleapis.com
```

2. Service Quota increase: `In-use IP addresses (default is 8)`. Have this increased to 64. _Note: this increase should be immediate, otherwise contact GCP support/account maangement_

![Screenshot of Quota Increase](https://user-images.githubusercontent.com/6570292/210277244-f3a75d06-763f-4bdc-805e-4f8bd3c77ad5.png)

### Service Account

1. Create a service account and download the json key file, save the file as `creds.json`

2. Set env variable while in the directory with the `creds.json`:

    ```bash

    export GOOGLE_CREDENTIALS=$(pwd)/creds.json
    ```

3. In the project, give the service account the `Owner` role.

4. Example configuration for this module:

```hcl
kubernetes_cluster_configurations = {
  network_ranges = {
    "kubernetes_pods" : "10.65.0.0/16",
    "kubernetes_services" : "10.64.224.0/20",
    "kubernetes_nodes" : "10.64.64.0/23"
  }
  project_id = "glueops-demo-1"
  region     = "us-central1"
}
```
