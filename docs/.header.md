# terraform-module-cloud-gcp-kubernetes-cluster

This Terraform module deploys everything needed in GCP to get a kubernetes cluster up and running. This repo should be used in the context of deploying with the [admiral](https://github.com/glueops/admiral) repository.

## Prerequisites

- GCP Project
- Service account with environment variable set
- Service Quotas (Depending on Cluster Size)

For more details see: https://github.com/GlueOps/terraform-module-cloud-gcp-kubernetes-cluster/wiki/FAQ


## Terraform Deployment

### Example Usage of module

```hcl
module "captain" {
  source = "git::https://github.com/GlueOps/terraform-module-cloud-gcp-kubernetes-cluster.git?ref=feat/multiple-node-pools"
  network_ranges = {
    "kubernetes_pods" : "10.65.0.0/16",
    "kubernetes_services" : "10.64.224.0/20",
    "kubernetes_nodes" : "10.64.64.0/23"
  }
  project_id = "test-30-np"
  region     = "us-central1"
  zonal      = true

  node_pools = [
    {
      name               = "default-nodes-second"
      initial_node_count = 1
      machine_type       = "c2-standard-4"
      disk_type          = "pd-standard"
      disk_size_gb       = 30
      auto_upgrade       = false
      auto_repair        = true
      gke_version        = "1.24.10-gke.2300"
      node_count         = 3
      spot               = true
    }
  ]
  gke_version = "1.24.10-gke.2300"
}
```

### Deployment
To deploy Kubernetes, run the following commands from the root directory of created for this deployment:

```bash
terraform -chdir=admiral/kubernetes-cluster init
terraform -chdir=admiral/kubernetes-cluster apply -state=$(pwd)/terraform_states/kubernetes-cluster.terraform.tfstate
```
